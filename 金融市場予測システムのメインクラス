
class MarketPredictionSystem:
    """é‡‘èå¸‚å ´äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ¡ã‚¤ãƒ³ã‚¯ãƒ©ã‚¹"""

    def __init__(
        self, config_file: str = "config.json", advisor_config_file: str = "advisor_config.json",
        logger_manager: LoggerManager = APP_LOGGER_MANAGER, # å¤–éƒ¨ã‹ã‚‰LoggerManagerã‚’æ³¨å…¥å¯èƒ½ã«
        reuse_hyperparams_on_init: bool = False,
        data_source_type: str = "api" # "api" or "csv"
    ):
        self.logger_manager = logger_manager
        self.logger = self.logger_manager.get_logger(self.__class__.__name__)
        self.logger.info(f"ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–é–‹å§‹ã€‚ãƒ¡ã‚¤ãƒ³è¨­å®š: {config_file}, ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼è¨­å®š: {advisor_config_file}, ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹: {data_source_type}")

        self.config = Config(config_file, logger_manager=self.logger_manager)

        # HTTPã‚»ãƒƒã‚·ãƒ§ãƒ³ (DataFetcher APIç”¨)
        self.http_session: Optional[Any] = None # CurlSessionã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
        if CurlSession: # ã‚°ãƒ­ãƒ¼ãƒãƒ«CurlSessionãŒå®šç¾©ã•ã‚Œã¦ã„ã‚Œã°
            try:
                if CurlSession.__module__.startswith("curl_cffi"):
                    self.http_session = CurlSession(impersonate="chrome110")
                    self.logger.info("HTTPã‚»ãƒƒã‚·ãƒ§ãƒ³ã« curl_cffi.requests.Session ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚")
                else:
                    self.http_session = CurlSession()
                    self.logger.info("HTTPã‚»ãƒƒã‚·ãƒ§ãƒ³ã« requests.Session ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚")
            except Exception as e:
                self.logger.warning(f"ã‚°ãƒ­ãƒ¼ãƒãƒ«CurlSessionã‹ã‚‰ã®HTTPã‚»ãƒƒã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã«å¤±æ•—: {e}")
        else:
            self.logger.warning("CurlSessionã‚¨ã‚¤ãƒªã‚¢ã‚¹ãŒæœªå®šç¾©ã€‚APIãƒ™ãƒ¼ã‚¹ã®DataFetcherã¯HTTPã‚»ãƒƒã‚·ãƒ§ãƒ³ãªã—ã§å‹•ä½œã—ã¾ã™ã€‚")

        # ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚§ãƒƒãƒãƒ£ãƒ¼ã®é¸æŠ
        self.data_source_type = data_source_type.lower()
        if self.data_source_type == "csv":
            self.data_fetcher: Union[CSVDataFetcher, DataFetcher] = CSVDataFetcher(self.config, self.logger_manager)
            self.logger.info("CSVDataFetcher ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚")
        elif self.data_source_type == "api":
            self.data_fetcher = DataFetcher(self.config, self.logger_manager, session=self.http_session)
            self.logger.info("DataFetcher (APIãƒ™ãƒ¼ã‚¹) ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚")
        else:
            self.logger.error(f"ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ—: {data_source_type}ã€‚'api' ã¾ãŸã¯ 'csv' ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ã€‚APIã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã¨ã—ã¾ã™ã€‚")
            self.data_fetcher = DataFetcher(self.config, self.logger_manager, session=self.http_session) # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

        self.feature_engineering = FeatureEngineering(self.config, self.logger_manager)
        self.lstm_model = LSTMModel(self.config, self.logger_manager)
        self.visualizer = MarketVisualizer(self.config, self.logger_manager)
        self.advisor_config_file = advisor_config_file # InvestmentAdvisoråˆæœŸåŒ–æ™‚ã«æ¸¡ã™

        if reuse_hyperparams_on_init:
            self.lstm_model.load_best_params()

        self.market_data_store: Dict[str, Any] = {}
        self.trained_models_store: Dict[str, Any] = {}


    def run(
        self, force_hyperparam_optimization: bool = False,
        optimization_n_trials: Optional[int] = None,
        generate_report_profile: str = "natural"
    ) -> bool:
        self.logger.info(f"ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œé–‹å§‹ã€‚æœ€é©åŒ–å¼·åˆ¶:{force_hyperparam_optimization}, Optunaè©¦è¡Œ:{optimization_n_trials or 'ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ'}, ãƒ¬ãƒãƒ¼ãƒˆãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«:{generate_report_profile}")
        run_start_time = datetime.now()
        overall_success = False
        try:
            # 1. ãƒ‡ãƒ¼ã‚¿å–å¾—
            self.logger.info("--- ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹ ---")
            self.market_data_store = self.data_fetcher.fetch_all_indexes()
            if not self.market_data_store or "^GSPC" not in self.market_data_store or self.market_data_store["^GSPC"]["df"].empty:
                self.logger.critical("ä¸»è¦å¸‚å ´ãƒ‡ãƒ¼ã‚¿(S&P500)å–å¾—å¤±æ•—ã€‚ã‚·ã‚¹ãƒ†ãƒ ç¶šè¡Œä¸å¯ã€‚")
                return False
            self.logger.info("ãƒ‡ãƒ¼ã‚¿å–å¾—ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã€‚")

            # 2. ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°
            self.logger.info("--- ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹ ---")
            self.market_data_store = self.feature_engineering.add_technical_indicators(self.market_data_store)
            self.logger.info("ç‰¹å¾´é‡ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ãƒªãƒ³ã‚°ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã€‚")

            # 3. ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ– (S&P500å¯¾è±¡)
            if force_hyperparam_optimization or (not self.lstm_model.best_params and self.lstm_model.load_best_params() is False) : # ãƒ­ãƒ¼ãƒ‰è©¦è¡Œã—ã¦ãƒ€ãƒ¡ãªã‚‰
                self.logger.info("--- LSTMãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹ (S&P500) ---")
                if "^GSPC" in self.market_data_store and not self.market_data_store["^GSPC"]["df"].empty:
                    self.lstm_model.optimize_hyperparameters(self.market_data_store, target_ticker="^GSPC", n_trials=optimization_n_trials)
                else: self.logger.warning("S&P500ãƒ‡ãƒ¼ã‚¿ä¸ååˆ†ã§æœ€é©åŒ–ã‚¹ã‚­ãƒƒãƒ—ã€‚")
                self.logger.info("ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã€‚")
            else: self.logger.info("æ—¢å­˜ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä½¿ç”¨ã¾ãŸã¯æœ€é©åŒ–è¦æ±‚ãªã—ã€‚")

            # 4. LSTMãƒ¢ãƒ‡ãƒ«å­¦ç¿’ (S&P500å¯¾è±¡)
            self.logger.info("--- LSTMãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹ (S&P500) ---")
            if "^GSPC" in self.market_data_store and not self.market_data_store["^GSPC"]["df"].empty:
                if not self.lstm_model.best_params: self.lstm_model.load_best_params() # å†åº¦ãƒ­ãƒ¼ãƒ‰è©¦è¡Œ
                self.trained_models_store = self.lstm_model.train_models_for_sp500(self.market_data_store)
            else: self.logger.error("S&P500ãƒ‡ãƒ¼ã‚¿ä¸ååˆ†ã§LSTMå­¦ç¿’ã‚¹ã‚­ãƒƒãƒ—ã€‚")
            self.logger.info("LSTMãƒ¢ãƒ‡ãƒ«å­¦ç¿’ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã€‚")

            # 5. å¯è¦–åŒ– (S&P500å¯¾è±¡)
            self.logger.info("--- å¯è¦–åŒ–ãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹ (S&P500) ---")
            if "^GSPC" in self.market_data_store and self.trained_models_store:
                graph_path = self.visualizer.plot_predictions_for_sp500(self.market_data_store, self.trained_models_store)
                if graph_path: self.logger.info(f"åˆ†æã‚°ãƒ©ãƒ•ã‚’ {graph_path} ã«ä¿å­˜ã€‚")
                else: self.logger.warning("ã‚°ãƒ©ãƒ•ç”Ÿæˆ/ä¿å­˜å¤±æ•—ã€‚")
            else: self.logger.warning("S&P500ãƒ‡ãƒ¼ã‚¿ã¾ãŸã¯å­¦ç¿’æ¸ˆãƒ¢ãƒ‡ãƒ«ãªã—ã€‚å¯è¦–åŒ–ã‚¹ã‚­ãƒƒãƒ—ã€‚")
            self.logger.info("å¯è¦–åŒ–ãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã€‚")

            # 6. æŠ•è³‡ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆ (S&P500å¯¾è±¡)
            self.logger.info("--- æŠ•è³‡ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆãƒ•ã‚§ãƒ¼ã‚ºé–‹å§‹ (S&P500) ---")
            if "^GSPC" in self.market_data_store and self.trained_models_store:
                advisor = InvestmentAdvisor(
                    self.market_data_store, self.trained_models_store, self.logger_manager,
                    self.advisor_config_file, generate_report_profile
                )
                if not advisor.generate_investment_report(save_to_json=True, print_to_console=True):
                    self.logger.warning("æŠ•è³‡ã‚¢ãƒ‰ãƒã‚¤ã‚¹ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå¤±æ•—ã€‚")
            else: self.logger.warning("S&P500ãƒ‡ãƒ¼ã‚¿ã¾ãŸã¯å­¦ç¿’æ¸ˆãƒ¢ãƒ‡ãƒ«ãªã—ã€‚æŠ•è³‡ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆã‚¹ã‚­ãƒƒãƒ—ã€‚")
            self.logger.info("æŠ•è³‡ã‚¢ãƒ‰ãƒã‚¤ã‚¹ç”Ÿæˆãƒ•ã‚§ãƒ¼ã‚ºå®Œäº†ã€‚")
            overall_success = True

        except KeyboardInterrupt:
            self.logger.warning("ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚Šå‡¦ç†ãŒä¸­æ–­ã•ã‚Œã¾ã—ãŸã€‚")
        except Exception as e:
            self.logger.critical(f"ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œä¸­ã«è‡´å‘½çš„ã‚¨ãƒ©ãƒ¼: {e}", exc_info=True)
        finally:
            self.logger_manager.save_performance_log() # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ­ã‚°ä¿å­˜
            duration_sec = (datetime.now() - run_start_time).total_seconds()
            self.logger.info(f"å¸‚å ´äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ å…¨å‡¦ç†çµ‚äº†ã€‚æ‰€è¦æ™‚é–“: {duration_sec:.2f}ç§’ã€‚æˆåŠŸ: {overall_success}")
        return overall_success


# --- Jupyter Notebook / ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œã®ãŸã‚ã®ãƒ¡ã‚¤ãƒ³å‡¦ç†éƒ¨åˆ† ---
if __name__ == "__main__":
    # ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªLoggerManagerã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½¿ç”¨
    main_logger = APP_LOGGER_MANAGER.get_logger("MainExecution")
    main_logger.info("ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œé–‹å§‹ã€‚")

    # --- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ (å¿…è¦ã«å¿œã˜ã¦å¤‰æ›´) ---
    main_config_path = "config.json"
    advisor_config_path = "advisor_config.json"
    # config.jsonã®ã‚µãƒ³ãƒ—ãƒ« (ä¸Šè¨˜ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’å‚è€ƒã«ä½œæˆã—ã¦ãã ã•ã„)
    # advisor_config.jsonã®ã‚µãƒ³ãƒ—ãƒ« (ä¸Šè¨˜ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’å‚è€ƒã«ä½œæˆã—ã¦ãã ã•ã„)

    # Jupyter Notebookç’°å¢ƒã‹ã©ã†ã‹ã§UIã‚’åˆ†å²
    is_jupyter = False
    try:
        # Jupyterç’°å¢ƒã§ã®ã¿æˆåŠŸã™ã‚‹ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
        from IPython import get_ipython
        if get_ipython() is not None and 'IPKernelApp' in get_ipython().config:
            is_jupyter = True
            import ipywidgets as widgets
            from IPython.display import display, clear_output
            main_logger.info("Jupyter Notebookç’°å¢ƒã‚’æ¤œå‡ºã€‚ipywidgets UIã‚’ä½¿ç”¨ã—ã¾ã™ã€‚")
    except ImportError:
        main_logger.info("Jupyter Notebookç’°å¢ƒã§ã¯ãªã„ã‹ã€ipywidgetsãŒã‚ã‚Šã¾ã›ã‚“ã€‚CUIãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã—ã¾ã™ã€‚")


    if is_jupyter:
        # --- Jupyter UI ---
        data_source_selector_ui = widgets.ToggleButtons(
            options=[('API (yfinance)', 'api'), ('ãƒ­ãƒ¼ã‚«ãƒ«CSV', 'csv')], description='ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹:', value='api',
            style={'button_width': 'auto'}, tooltips=['yfinanceçµŒç”±ã§æœ€æ–°ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—', 'äº‹å‰ã«ç”¨æ„ã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ç”¨']
        )
        hyperparam_mode_selector_ui = widgets.ToggleButtons(
            options=[('æ–°è¦æœ€é©åŒ–', 'optimize'), ('ä¿å­˜ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æµç”¨', 'reuse')], description='ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:', value='reuse',
            style={'button_width': 'auto'}
        )
        optuna_trials_input_ui = widgets.IntText(
            value=APP_LOGGER_MANAGER.get_logger("UI_Config").info("Optunaè©¦è¡Œå›æ•°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯Configã‹ã‚‰å–å¾—ã‚’æ¨å¥¨") or 5, # configã‹ã‚‰å–å¾—ã—ãŸã„
            description='Optunaè©¦è¡Œå›æ•°:', disabled=(hyperparam_mode_selector_ui.value == 'reuse')
        )
        def handle_hyperparam_mode_change(change): optuna_trials_input_ui.disabled = (change.new == 'reuse')
        hyperparam_mode_selector_ui.observe(handle_hyperparam_mode_change, names='value')

        # ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã¯AdvisorConfigLoaderã‹ã‚‰å‹•çš„ã«å–å¾—ã—ãŸã„
        # ã“ã“ã§ã¯ä»®ã®ãƒªã‚¹ãƒˆã‚’ä½¿ç”¨ã€‚ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œæ™‚ã«AdvisorConfigLoaderãŒåˆæœŸåŒ–ã•ã‚Œã‚‹ã®ã§ã€ãã®æ™‚ç‚¹ã§å–å¾—ã™ã‚‹ã®ãŒç†æƒ³
        temp_advisor_loader = AdvisorConfigLoader(advisor_config_path, APP_LOGGER_MANAGER)
        profile_options_ui = [(p.capitalize(), p) for p in temp_advisor_loader.get_profile_list()]
        if not profile_options_ui: profile_options_ui = [('Natural', 'natural')] # ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

        advisor_profile_selector_ui = widgets.Dropdown(
            options=profile_options_ui, value=profile_options_ui[0][1] if profile_options_ui else 'natural',
            description='æŠ•è³‡åˆ¤æ–­ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«:', style={'description_width': 'initial'}
        )
        run_button_ui = widgets.Button(description='å¸‚å ´äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œ', button_style='success', icon='cogs')
        output_area_ui = widgets.Output()

        display(data_source_selector_ui, hyperparam_mode_selector_ui, optuna_trials_input_ui, advisor_profile_selector_ui, run_button_ui, output_area_ui)

        def on_run_button_clicked_ui(b):
            with output_area_ui:
                clear_output(wait=True)
                main_logger.info("--- UIã‹ã‚‰ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œé–‹å§‹ ---")
                data_src = data_source_selector_ui.value
                force_opt = (hyperparam_mode_selector_ui.value == 'optimize')
                opt_trials = optuna_trials_input_ui.value if force_opt else None
                report_prof = advisor_profile_selector_ui.value

                system = MarketPredictionSystem(
                    main_config_path, advisor_config_path, APP_LOGGER_MANAGER,
                    reuse_hyperparams_on_init=(not force_opt), data_source_type=data_src
                )
                success = system.run(force_opt, opt_trials, report_prof)
                print(f"\nğŸ‰ ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œ {'æ­£å¸¸å®Œäº†' if success else 'ã§ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ'} ğŸ‰" if success else "\nğŸ’¥ ã‚·ã‚¹ãƒ†ãƒ å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ ğŸ’¥")
        run_button_ui.on_click(on_run_button_clicked_ui)

    else:
        # --- CUIãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ ---
        print("="*30 + "\né‡‘èå¸‚å ´äºˆæ¸¬ã‚·ã‚¹ãƒ†ãƒ  (CUIãƒ¢ãƒ¼ãƒ‰)\n" + "="*30)
        ds_input = input("ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’é¸æŠ [api, csv] (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: api): ").strip().lower() or "api"
        mode_input = input("ãƒã‚¤ãƒ‘ãƒ¼ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¢ãƒ¼ãƒ‰ã‚’é¸æŠ [optimize, reuse] (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: reuse): ").strip().lower() or "reuse"
        force_opt_cui = (mode_input == "optimize")
        opt_trials_cui_val = None
        if force_opt_cui:
            try: opt_trials_cui_val = int(input("Optunaè©¦è¡Œå›æ•°ã‚’å…¥åŠ› (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5): ").strip() or "5")
            except ValueError: opt_trials_cui_val = 5

        # ã‚¢ãƒ‰ãƒã‚¤ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ« (CUI)
        temp_advisor_loader_cui = AdvisorConfigLoader(advisor_config_path, APP_LOGGER_MANAGER)
        profiles_cui = temp_advisor_loader_cui.get_profile_list()
        profile_prompt = f"æŠ•è³‡åˆ¤æ–­ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ [{', '.join(profiles_cui)}] (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: {profiles_cui[0] if profiles_cui else 'natural'}): "
        profile_input_cui = input(profile_prompt).strip().lower() or (profiles_cui[0] if profiles_cui else 'natural')
        if profile_input_cui not in profiles_cui and profiles_cui : profile_input_cui = profiles_cui[0] # ä¸æ­£å…¥åŠ›æ™‚ã¯å…ˆé ­

        system_cui = MarketPredictionSystem(
            main_config_path, advisor_config_path, APP_LOGGER_MANAGER,
            reuse_hyperparams_on_init=(not force_opt_cui), data_source_type=ds_input
        )
        system_cui.run(force_opt_cui, opt_trials_cui_val, profile_input_cui)

    main_logger.info("ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œçµ‚äº†ã€‚")
